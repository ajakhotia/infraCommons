name: normalize
description: |
  Normalize a string for use with Docker-related operations.
  - Converts to lowercase
  - Replaces non [a-z0-9/] characters with '-'
  - Collapses consecutive '-' and '/'
  - Strips leading/trailing dashes and slashes
  - Warns (does not fail) if the result exceeds 200 characters

inputs:
  string:
    required: true
    description: "String to normalize."

outputs:
  string:
    description: "Normalized string."
    value: ${{ steps.normalize.outputs.string }}

runs:
  using: "composite"
  steps:
    - name: normalize
      id: normalize
      shell: bash
      run: |
        string=$(echo '${{ inputs.string }}' \
          | tr '[:upper:]' '[:lower:]' \
          | sed -E 's/[^a-z0-9/]+/-/g' \
          | sed -E 's/-+/-/g' \
          | sed -E 's:/+:/:g' \
          | sed -E 's/^-+|-+$//g' \
          | sed -E 's:^/+|/+$::g')

        if [ ${#string} -gt 200 ]; then
          echo "::warning::Normalized string exceeds 200 characters (length=${#string})"
        fi

        echo "string=$string" >> "$GITHUB_OUTPUT"
